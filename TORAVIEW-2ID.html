<!DOCTYPE html>
<html>
<head>
<title>トラカメ死活監視用　セフテック㈱</title>
<style>
    body { font-family: sans-serif; }
    .container { display: flex; gap: 40px; }
    .input-section { flex: 1; min-width: 150px; }
    .url-input-section { display: block; }
    .url-input-section.hidden { display: none; }
    .camera-input-group { margin-bottom: 15px; border: 1px solid #ccc; padding: 10px; }
    .camera-input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .camera-input-group input { width: 250px; padding: 5px; border: 1px solid #ccc; } /* 幅を小さく変更 */
    .camera-input-group input[name^="url"] { background-color: #f9f9f9; }
    .camera-input-group input[name^="name"] { background-color: #e9e9e9; }
    .camera-input-group input[name^="id"],
    .camera-input-group input[name^="password"] { width: 150px; } /* IDとパスワードの幅を個別に設定 */
    
    .display-section { flex: 2; }
    .image-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .image-item { border: 1px solid #ccc; padding: 10px; text-align: center; }
    .camera-image { max-width: 100%; height: auto; }
    .status-icon { font-size: 1.5em; vertical-align: middle; margin-right: 5px; }
    .status-ok { color: green; }
    .status-error { color: red; }
    .camera-info { font-size: 0.9em; color: #555; margin-top: 5px; }
    
    .button-group { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; }
    
    @media print {
        body { font-size: 10pt; }
        .no-print { display: none; }
        .container { flex-direction: column; }
        .input-section { display: none; }
        .display-section { width: 100%; }
        .image-grid { grid-template-columns: repeat(1, 1fr); gap: 0; }
        .image-item { border: none; page-break-inside: avoid; }
        .camera-image { width: 100%; height: auto; margin: 0; }
        .camera-info { font-size: 8pt; margin: 0; }
        h1, h2 { display: none; }
    }
</style>
<script>
    var imagesDisplayed = false;
    var urlInputsVisible = true;
    var autoRefreshInterval;

    function toggleUrlInputs() {
        var urlInputSection = document.getElementById('url-input-section');
        var toggleBtn = document.getElementById('toggleBtn');
        
        if (urlInputsVisible) {
            urlInputSection.classList.add('hidden');
            toggleBtn.textContent = 'URL入力欄を表示';
        } else {
            urlInputSection.classList.remove('hidden');
            toggleBtn.textContent = 'URL入力欄を最小化';
        }
        urlInputsVisible = !urlInputsVisible;
    }

    function startAutoRefresh() {
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
        }
        
        var intervalSelect = document.getElementById('refreshInterval');
        var intervalValue = parseInt(intervalSelect.value);

        if (intervalValue > 0) {
            autoRefreshInterval = setInterval(refreshAllImages, intervalValue);
            alert('自動更新を開始しました。');
        } else {
            alert('自動更新を停止しました。');
        }
    }

    function refreshAllImages() {
        if (imagesDisplayed) {
            for (var i = 1; i <= 25; i++) {
                var url = document.getElementById('url' + i).value;
                var id = document.getElementById('id' + i).value;
                var password = document.getElementById('password' + i).value;
                
                if (url) {
                    var finalUrl = url;
                    if (id && password) {
                        finalUrl = addAuthToUrl(url, id, password);
                    }
                    var image = document.getElementById('cameraImage' + i);
                    if (image) {
                        image.src = finalUrl.split('?')[0] + '?' + 'v=' + Math.random();
                    }
                }
            }
        }
    }

    function displayImages() {
        if (imagesDisplayed) {
            return;
        }
        
        var imageGrid = document.getElementById('imageGrid');
        imageGrid.innerHTML = '';
        
        for (var i = 1; i <= 25; i++) {
            var url = document.getElementById('url' + i).value;
            var name = document.getElementById('name' + i).value;
            var id = document.getElementById('id' + i).value;
            var password = document.getElementById('password' + i).value;
            
            if (url) {
                var finalUrl = url;
                if (id && password) {
                    finalUrl = addAuthToUrl(url, id, password);
                }
                
                var imageItem = document.createElement('div');
                imageItem.className = 'image-item';

                var statusContainer = document.createElement('div');
                statusContainer.className = 'no-print';
                var statusIcon = document.createElement('span');
                statusIcon.id = 'status' + i;
                statusIcon.className = 'status-icon';
                statusContainer.appendChild(statusIcon);
                
                var img = document.createElement('img');
                img.id = 'cameraImage' + i;
                img.src = finalUrl;
                img.alt = 'カメラ ' + i + ' の画像';
                img.className = 'camera-image';

                img.onload = function() {
                    document.getElementById('status' + this.id.substring(11)).innerHTML = '✔';
                    document.getElementById('status' + this.id.substring(11)).classList.add('status-ok');
                    document.getElementById('status' + this.id.substring(11)).classList.remove('status-error');
                };
                img.onerror = function() {
                    document.getElementById('status' + this.id.substring(11)).innerHTML = '✖';
                    document.getElementById('status' + this.id.substring(11)).classList.add('status-error');
                    document.getElementById('status' + this.id.substring(11)).classList.remove('status-ok');
                };
                
                var cameraInfo = document.createElement('div');
                cameraInfo.className = 'camera-info';
                cameraInfo.textContent = (name || 'カメラ ' + i);
                
                imageItem.appendChild(statusContainer);
                imageItem.appendChild(img);
                imageItem.appendChild(cameraInfo);
                imageGrid.appendChild(imageItem);
            }
        }
        imagesDisplayed = true;
    }
    
    // URLに認証情報を付加する関数
    function addAuthToUrl(url, id, password) {
        if (url.startsWith('http://')) {
            var parts = url.split('//');
            return parts[0] + '//' + id + ':' + password + '@' + parts[1];
        }
        return url;
    }

    function loadCsv() {
        var fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.csv';
        
        fileInput.onchange = function(e) {
            var file = e.target.files[0];
            if (!file) return;

            var reader = new FileReader();
            reader.onload = function(event) {
                var csvData = event.target.result;
                var lines = csvData.split(/\r?\n/);
                
                for (var i = 0; i < lines.length && i < 25; i++) {
                    var parts = lines[i].split(',');
                    var url = parts[0] ? parts[0].trim() : '';
                    var name = parts[1] ? parts[1].trim() : '';
                    var id = parts[2] ? parts[2].trim() : '';
                    var password = parts[3] ? parts[3].trim() : '';
                    
                    document.getElementById('url' + (i + 1)).value = url;
                    document.getElementById('name' + (i + 1)).value = name;
                    document.getElementById('id' + (i + 1)).value = id;
                    document.getElementById('password' + (i + 1)).value = password;
                }
            };
            reader.readAsText(file, 'Shift_JIS');
        };
        fileInput.click();
    }
</script>
</head>
<body>

<h1>トラカメ死活監視用　セフテック㈱</h1>

<div class="container">
    <div class="input-section no-print">
        <p>最大25台のカメラURLと名前を入力してください。</p>
        
        <div class="button-group">
            <button onclick="displayImages()">画像取得</button>
            <button onclick="refreshAllImages()">画像再取得</button>
            <button onclick="startAutoRefresh()">自動更新を開始/停止</button>
            <button id="toggleBtn" onclick="toggleUrlInputs()">URL入力欄を最小化</button>
            <button onclick="window.print()">PDF作成（印刷）</button>
            <button onclick="loadCsv()">CSV読み込み</button>
        </div>
        
        <label for="refreshInterval">自動更新間隔:</label>
        <select id="refreshInterval">
            <option value="0">更新しない</option>
            <option value="60000">1分ごと</option>
            <option value="3600000">1時間ごと</option>
            <option value="10800000">3時間ごと</option>
        </select>
        
        <hr>
        <div id="url-input-section" class="url-input-section">
            <script>
                for (var i = 1; i <= 25; i++) {
                    document.write('<div class="camera-input-group">');
                    document.write('<div>カメラ ' + i + '</div>');
                    document.write('<label for="url' + i + '">URL:</label>');
                    document.write('<input type="text" id="url' + i + '" name="url' + i + '">');
                    document.write('<label for="id' + i + '">ユーザーID:</label>');
                    document.write('<input type="text" id="id' + i + '" name="id' + i + '">');
                    document.write('<label for="password' + i + '">パスワード:</label>');
                    document.write('<input type="password" id="password' + i + '" name="password' + i + '">');
                    document.write('<label for="name' + i + '">カメラ名:</label>');
                    document.write('<input type="text" id="name' + i + '" name="name' + i + '">');
                    document.write('</div>');
                }
            </script>
        </div>
    </div>

    <div class="display-section">
        <h2>カメラ画像</h2>
        <div id="imageGrid" class="image-grid">
            </div>
    </div>
</div>

</body>
</html>